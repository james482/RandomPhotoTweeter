import os
import logging
import random
import datetime
import tweet


def post(conf, dir):
    file_type = conf.get_file_types()
    max_size = conf.get_max_size()
    pic_last = conf.get_old_pic()
    today = datetime.datetime.now().strftime("%A")

    pic = os.path.join(dir, random.choice(os.listdir(dir)))

    while (pic == pic_last) or (os.path.getsize(pic) > (max_size * 1000000)) or (not pic.endswith(file_type)):
        if pic == pic_last:
            logging.debug('Same pic: ' + pic)
        elif not pic.endswith(file_type):
            logging.debug('Not a pic: ' + pic)
        elif os.path.getsize(pic) > (max_size * 1000000):
            logging.debug('Pic too big: ' + pic)

        pic = os.path.join(dir, random.choice(os.listdir(dir)))

    logging.debug('Posting: ' + pic)
    status = random.choice(conf.get_status_day(today))

    p = [pic, status]
    tweet.tweet_with_pic(conf, p)
    return
